# Lista 5

1.  Podłącz układ EEPROM I<sup>2</sup>C [24C04](https://skos.ii.uni.wroc.pl/pluginfile.php/13694/mod_assign/intro/24C04.pdf) do pinów TWI. Zaimplementuj program umożliwiający zapisywanie i odczytywanie danych wewnątrz układu. Możesz wykorzystać przykładowe procedury obsługi I<sup>2</sup>C zdefiniowane w książce [Make: AVR Programming](https://skos.ii.uni.wroc.pl/mod/resource/view.php?id=4176 "Make: AVR Programming"). Komunikacja z programem ma się odbywać przez UART, program powinien obsługiwać następujące polecenia:
    *   read addr – odczyt bajtu z adresu _addr_,
    *   write addr value – zapis pod adres _addr_ wartości _value_,
    *   read addr length – odczyt _length_ bajtów od adresu _addr_, dane należy wypisać w formacie [I8HEX](http://en.wikipedia.org/wiki/Intel_HEX#Named_formats),
    *   write – zapis danych, kolejne wiersze powinny zawierać dane w formacie [I8HEX](http://en.wikipedia.org/wiki/Intel_HEX#Named_formats).Zaimplementowanie każdego z podpunktów jest warte jeden punkt. **[4]**
2.  Wykorzystaj układ drivera LED [SCT2168](http://www.starchips.com.tw/pdf/datasheet/SCT2168V01_01.pdf) (do wypożyczenia), aby zrealizować efekt przewijającej się diodki (Knight Rider / oczy Cylonów). Wykorzystanie układu pozwoli na użycie diod świecących bez rezystorów w szeregu. Jako Rext można wykorzystać rezystor 2.2kΩ (2k2). Pin OE/ należy połączyć na stałe z GND, natomiast pin LA/ powinien być sterowany z wybranego pinu wyjściowego zgodnie z obrazkiem "Timing diagram" w nocie katalogowej SCT2168 (str.3). Należy wykorzystać wbudowany w mikrokontroler podsystem SPI (MOSI - SDI, SCK - CLK); sterowanie układem programowo (bit-banging) obniży punktację o 1 punkt. **[3]**
3.  Zrealizuj za pomocą dwóch Arduino (zadanie można wykonać w dwie osoby) grę typu zgadnij liczbę.  
    Pierwsze Arduino (SPI slave) powinno wylosować liczbę M z zakresu 0-99, po czym przy użyciu protokołu SPI odpowiadać na pytania – czy zadana liczba N jest mniejsza, większa czy równa liczbie M? (Można to zrobić przez dwa zapytania na magistrali: w pierwszym master podaje liczbę N, slave odsyła 0; w drugim master wysyła 0, slave odsyła wartość 1/0/-1). Jeśli master zgadł, liczba M powinna zostać wylosowana ponownie.  
    Drugie Arduino (SPI master) powinno odczytać przez UART liczbę N z komputera, spytać o nią slave'a, po czym zaprezentować wynik (np. mignąć jedną z trzech diod i napisać komunikat przez UART). **[4]**
4.  Połącz przewodami wybrane cztery piny Arduino z pinami MISO, MOSI, SCK, SS. Skonfiguruj kontroler SPI jako slave. Napisz program, który będzie programowo (przez odczyty i zapisy wartości pinów – tak zwany bit-banging) pracował jako SPI master i komunikował się z wbudowanym kontrolerem SPI (np. przesyłając kolejno liczby 1, 2, 3...). Odbieraj dane z kontrolera SPI (rejestr SPDR) i sprawdzaj, czy odebrane liczby są równe wysłanym. **[2]**

Uwaga! Używając wbudowanego kontrolera SPI jako master należy pamiętać o ustawieniu pinów MOSI, SCK **i SS** (PB3, PB5, PB2) jako wyjścia. (Nota katalogowa Atmega328P, podpunkt 23.3.2).
